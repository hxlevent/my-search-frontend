<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>데이터 조회 서비스</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif; margin: 0; padding: 20px; background-color: #f4f7f9; color: #333; }
        .container { max-width: 800px; margin: 40px auto; background: #fff; padding: 30px; border-radius: 8px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        h1 { text-align: center; color: #2c3e50; }
        .search-box { display: flex; gap: 10px; margin-bottom: 20px; }
        #searchId { flex-grow: 1; padding: 12px; font-size: 16px; border: 1px solid #ccc; border-radius: 4px; }
        button { padding: 12px 20px; font-size: 16px; cursor: pointer; background-color: #3498db; color: white; border: none; border-radius: 4px; transition: background-color 0.3s; }
        button:hover { background-color: #2980b9; }
        #loader { text-align: center; padding: 20px; display: none; }
        #resultsTable { border-collapse: collapse; margin-top: 20px; width: 100%; font-size: 14px; }
        th, td { border: 1px solid #ddd; padding: 10px; text-align: left; }
        th { background-color: #ecf0f1; color: #34495e; }
        tr:nth-child(even) { background-color: #f9f9f9; }
    </style>
</head>
<body>
    <div class="container">
        <h1>데이터 조회</h1>
        <div class="search-box">
            <input type="text" id="searchId" placeholder="고유번호를 입력하고 Enter" onkeydown="if(event.keyCode==13) search()">
            <button onclick="search()">검색</button>
        </div>
        <div id="loader">
            <p>데이터를 검색 중입니다... 잠시만 기다려주세요.</p>
            <p>경과 시간: <span id="timer">0.0</span>초</p>
        </div>
        <div id="results"></div>
    </div>

    <script>
        // ★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★
        // 3부에서 성공한 나의 Render 서버 주소를 여기에 붙여넣으세요!
        const baseUrl = 'https://my-search-backend.onrender.com';
        const apiUrl = `${baseUrl}/search`;
        // ★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★

        let timerInterval;

        function startTimer() {
            let startTime = Date.now();
            document.getElementById('timer').textContent = '0.0';
            timerInterval = setInterval(() => {
                const elapsedTime = ((Date.now() - startTime) / 1000).toFixed(1);
                document.getElementById('timer').textContent = elapsedTime;
            }, 100);
        }

        function stopTimer() {
            clearInterval(timerInterval);
        }

        function search() {
            const searchId = document.getElementById('searchId').value;
            if (!searchId) {
                alert('고유번호를 입력하세요.');
                return;
            }

            document.getElementById('loader').style.display = 'block';
            document.getElementById('results').innerHTML = '';
            startTimer();

            fetch(`${apiUrl}?id=${encodeURIComponent(searchId)}`)
                .then(response => {
                    if (!response.ok) {
                        throw new Error('서버에 문제가 발생했습니다. 잠시 후 다시 시도해주세요.');
                    }
                    return response.json();
                })
                .then(data => {
                    stopTimer();
                    document.getElementById('loader').style.display = 'none';
                    displayResults(data);
                })
                .catch(error => {
                    stopTimer();
                    document.getElementById('loader').style.display = 'none';
                    document.getElementById('results').innerHTML = `<p style="color: red;">오류: ${error.message}</p>`;
                    console.error('Fetch Error:', error);
                });
        }

        function displayResults(data) {
            const resultsDiv = document.getElementById('results');
            if (data.length === 0) {
                resultsDiv.innerHTML = '<p>검색 결과가 없습니다.</p>';
                return;
            }

            let table = '<table id="resultsTable">';
            table += '<thead><tr><th>고유번호</th><th>날짜</th><th>시간</th><th>인증 시리얼넘버</th></tr></thead>';
            table += '<tbody>';

            data.forEach(row => {
                table += '<tr>';
                table += `<td>${row.unique_id || ''}</td>`;
                table += `<td>${row.날짜 || ''}</td>`;
                table += `<td>${row.시간 || ''}</td>`;
                table += `<td>${row['인증 시리얼넘버'] || ''}</td>`;
                table += '</tr>';
            });

            table += '</tbody></table>';
            resultsDiv.innerHTML = table;
        }
    </script>
</body>
</html>
